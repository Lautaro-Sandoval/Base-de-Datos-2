use("tiendaOnline");

// Crear un pipeline que obtenga los productos más valorados (puntuación promedio más alta) con al menos 2 valoraciones.

db.productos.aggregate([
    { $unwind: "$valoraciones"},
    { $group: {
        _id: "$nombre",
        "Valoracion Promedio": { $avg: "$valoraciones.puntuacion"},
        "Cantidad Valoraciones": { $sum: 1}
    }},
    { $sort: { "Valoracion Promedio": -1}},
    { $match: { "Cantidad Valoraciones": { $gte: 2}}}
]);